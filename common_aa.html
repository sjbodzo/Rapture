<html>
<head>
<link rel="stylesheet" type="text/css" href="theme.css">
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<title>Bioinformatics Project</title>
<style>canvas { width: 60%; height: 60% }</style>
</head>

<script src="./three.min.js" type="text/javascript"></script>
<script src="./amino_acids.js" type="text/javascript"></script>
<script src="./amino_acid.js" type="text/javascript"></script>
<script src="./sequence.js" type="text/javascript"></script>
<script src="./seqBuilder.js" type="text/javascript"></script>
<script src="./jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="./jquery.requestAnimationFrame.min.js" type="text/javascript"></script>
<script>

$(function() {
  console.log( "ready!" );
  initScene();
});

function onClick(event) {
  event.preventDefault();
  console.log("z = %f", camera.position.z);
  camera.position.z = -1*camera.position.z;
  console.log("z = %f", camera.position.z);
  camera.lookAt(new THREE.Vector3( 0, 0, 0 ));
  run();
}

function addMouseHandler() {
  var dom = renderer.domElement;
  dom.addEventListener('click', onClick, false);
}

function attachHandler(el, evtname, fn) {
  if (el.addEventListener) {
    el.addEventListener(evtname, fn.bind(el), false);
  } else if (el.attachEvent) {
    el.attachEvent('on' + evtname, fn.bind(el));
  }
}

attachHandler(window, "load", function() {
  var ele = document.querySelector("select[id=acid_select]");
  attachHandler(ele, "invalid", function (e) {
    this.setCustomValidity("");
    if (!e.target.validity.valid) {
      window.alert("Please input a valid amino acid sequence.");
    }
  });
});

var scene, camera, renderer, radius, theSeq, ms;
radius = 0.35;
bondLengthScalar = 0.8; //used to exaggerate bond lengths for visual clarity

function initScene() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera( 75, (window.innerWidth) / (window.innerHeight), 0.1, 1000 );
  camera.position.z = 10;
  camera.position.x = -6;
  camera.position.y = 0;

  var light = new THREE.DirectionalLight( 0xffffff, 1.5);
  //var light = new THREE.AmbientLight(0xffffff);
  light.position.set(0, 0, 1);
  scene.add(light);

  renderer = new THREE.WebGLRenderer( { antialias: true } );
  renderer.setSize( window.innerWidth/1.5, window.innerHeight/1.5 );
  var node = document.getElementById("renderBody");
  node.appendChild(renderer.domElement);

  addMouseHandler();
  console.log("Scene initialized...");
  renderer.render(scene, camera);

  document.addEventListener('keydown', function(event) {
    if(event.keyCode == 87) {
      //w key pressed (+y) -- pan up
      camera.position.y += (1);
    }
    else if(event.keyCode == 65) {
      //a key pressed (-x) -- strafe left
      camera.position.x += (-1);
    }
    else if(event.keyCode == 83) {
      //s key pressed (-y) -- pan down
      camera.position.y += (-1);
    }
    else if(event.keyCode == 68) {
      //d key pressed (+x) -- strafe right
      camera.position.x += (1);
    }
    else if(event.keyCode == 81) {
      //q key pressed (+z) -- zooms in
      zoom(-1,1);
    }
    else if(event.keyCode == 69) {
      //e key pressed (-z) -- zooms out
      zoom(1,1);
    }
    run();
  });
}


function zoom(scalar, magnitude) {
  console.log("Former z = %i", camera.position.z);
  camera.position.z += (scalar*magnitude);
  console.log("New z = %i", camera.position.z);
}

function addMouseHandler() {
  var dom = renderer.domElement;
  dom.addEventListener('mouseup', onMouseUp, false);
}

function onMouseUp (event) {
  event.preventDefault();
  //console.log("x = %f", event.clientX);
  //console.log("y = %f", event.clientY);
}


// SAMPLE INPUT: ADGIFILSAI
function processInputSeq() {
  //Initialize the sequence and fill the atoms in.
  theSeq = new Sequence();
  var inputStr = document.querySelector("select[id=acid_select]").value.toUpperCase();
  (theSeq.aminoAcidChain).push(new AminoAcid(identifyByLetter(inputStr.charAt(0))));
  (theSeq.aminoAcidChain[0]).fillAtoms();
  theSeq.drawSeq();

  //Relinquish focus from input.
  $('select#acid_select').blur();

  //if ()
}

function run() {
  renderer.render(scene, camera);

  /**
  for (var i = 0, len = theSeq.aminoAcidChain.length; i < len; i++) {
    for (var n = 0; n < theSeq.aminoAcidChain[i].length; n++) {
      theSeq.aminoAcidChain[i].atoms[n].mesh.rotation.x -= 0.5;
      theSeq.aminoAcidChain[i].atoms[n].mesh.rotation.y -= 0.5;
    }
  }
  **/

  // Ask for another frame
  //requestAnimationFrame(run);
}

</script>

<body>

<div id="titleBody">
<span id="theTitle"><h1>The 20 Common Amino Acids</h1></span>
</div>

<div id="renderBody">
</div>

<div id="mainBody">
<span id="spanBox">
Eukaryotes (organisms that are distinguished primarily by the presence of nuclei) have a common
code of 20 amino acids that they use to create proteins via the process of translation. Essentially,
there are building blocks known as nucleotides that, in groupings of 3 (called codons) code for
amino acids. </br></br>

The processes of transcription and translation refer collectively to this complex process
of mapping DNA from a sequence of nucleotides to a protein. Thus by modeling the 20 common amino acids,
we are able to visualize the pieces that make up proteins in your body. These amino acids are distinguished
by what is known as the R group. The R group is a collection of atoms. It is a unique identifier for
each protein, and helps determine certain chemical properties of its amino acid (namely polarity and charge).
</span></br></br>

<select id="acid_select" onchange="javascript:processInputSeq()">
  <option value="G">G - Glycine</option>
  <option value="A">A - Alanine</option>
  <option value="V">V - Valine</option>
  <option value="L">L - Leucine</option>
  <option value="I">I - Isoleucine</option>
  <option value="P">P - Proline</option>
  <option value="F">F - Phenylalanine</option>
  <option value="Y">Y - Tyrosine</option>
  <option value="W">W - Tryptophan</option>
  <option value="S">S - Serine</option>
  <option value="T">T - Threonine</option>
  <option value="C">C - Cysteine</option>
  <option value="M">M - Methionine</option>
  <option value="N">N - Asparagine</option>
  <option value="Q">Q - Glutamine</option>
  <option value="K">K - Lysine</option>
  <option value="R">R - Arginine</option>
  <option value="H">H - Histidine</option>
  <option value="D">D - Aspartate</option>
  <option value="E">E - Glutamate</option>
</select>

</body>
</html>
