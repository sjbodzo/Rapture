<html>
  <head>
    <title>Bioinformatics Project</title>
    <style>canvas { width: 100%; height: 100% }</style>
  </head>
  <body>
    <button type = "button" onclick = "wipeCanvas()" >
      Clear Canvas
    </button>
    <button type = "button" onclick = "initScene()" >
      Initialize
    </button>
    <button type = "button" onclick = "drawChildren()" >
      Draw Children
    </button>
    <button type = "button" onclick = "updateModelByPhi(1, Math.PI/2)" >
      UPHI5
    </button>

    <form action="javascript:processInputSeq()">
      <input name = "amino_seq_input" type ="text"
             maxlength ="20" pattern ="[GAVLIPFYWSTCMNQKRHDEgavlipfywstcmnqkrhde]{0,20}">
        Input AA SEQ (0-20)
      </input>
      <input type="submit" value="Run" />
    </form>

    <script src="./three.min.js" type="text/javascript"></script>
    <script src="./amino_acids.js" type="text/javascript"></script>
    <script src="./sequence.js" type="text/javascript"></script>
    <script src="./jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="./jquery.requestAnimationFrame.min.js" type="text/javascript"></script>
    <script>

    function addMouseHandler() {
      var dom = renderer.domElement;
      dom.addEventListener('click', onClick, false);
    }

    function onClick(event) {
      event.preventDefault();
      //window.alert(event.screenX + ' ' + event.screenY);
      //for (var i = 0, len = sequence.chain.length; i < len; i++) {
        //sequence = new Sequence();
        //TODO: create onClick, possibly for phi/psi modulation?
        //window.alert(sequence.chain[i].type);
      //}
    }

    function attachHandler(el, evtname, fn) {
        if (el.addEventListener) {
            el.addEventListener(evtname, fn.bind(el), false);
        } else if (el.attachEvent) {
            el.attachEvent('on' + evtname, fn.bind(el));
        }
      }
      attachHandler(window, "load", function(){
           var ele = document.querySelector("input[name=amino_seq_input]");
           attachHandler(ele, "invalid", function (e) {
              this.setCustomValidity("");
              if (!e.target.validity.valid) {
                window.alert("Please input a valid amino acid sequence.");
              }
          });
    });

      var scene, camera, renderer, radius, sequence;
      sequence = new Sequence();
      radius = 0.4;

      function initScene() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera( 75, (0.75*window.innerWidth) / (0.75*window.innerHeight), 0.1, 1000 );
        camera.position.z = 20;
        camera.position.x = 1;

        var light = new THREE.DirectionalLight( 0xffffff, 1.5);
        light.position.set(0, 0, 1);
        scene.add(light);

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        addMouseHandler();
      }

      // SAMPLE INPUT: ADGIFILSAI
      function processInputSeq() {
        var inputStr = document.querySelector("input[name=amino_seq_input]").value.toUpperCase();
        for (var i = 0, len = inputStr.length; i < len; i++) {
          //sequence = new Sequence();
          sequence.chain[i] = new AminoAcid(identifyByLetter(inputStr.charAt(i)));
          //window.alert(sequence.chain[i].type);
        }
        initScene();
        drawSequence();
      }

      function run() {
        renderer.render( scene, camera );

        for (var i = 0, len = sequence.chain.length; i < len; i++) {
          //sequence.chain[i].mesh.rotation.x -= 0.01;
          //sequence.chain[i].mesh.rotation.y -= 0.01;
        }

        // Ask for another frame
        //requestAnimationFrame(run);
      }

      function drawSequence() {
        sequence.currentX = -1*sequence.chain.length*radius/2;
        //window.alert(sequence.currentX);
        //window.alert(window.innerWidth);
        //window.alert(sequence.chain.length * radius);
        for (var i = 0, len = sequence.chain.length; i < len; i++) {
          scene.add(sequence.chain[i].mesh);
          sequence.currentX += 2*radius;
          sequence.chain[i].mesh.translateX(sequence.currentX);
          sequence.chain[i].X = sequence.currentX;
        }

        run();
      }

      function render() {
        requestAnimationFrame(render);
        renderer.render(scene, camera);
      }

      function wipeCanvas() {
        scene = new THREE.Scene();
      }

    </script>

  </body>
</html>
